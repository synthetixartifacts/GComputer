{% extends 'admin/public_agent/layout.html.twig' %}

{% block content_title %}Discussion Thread (ID: {{ discussion.id }}) - Agent: {{ agent.name }}{% endblock %}

{% block main %}
    <div class="mb-3">
        <a href="{{ path('admin_public_agent_discussions', {'id': agent.id}) }}" class="btn btn-secondary">Back to Discussions for {{ agent.name }}</a>
        <a href="{{ path('admin_public_agents') }}" class="btn btn-secondary">Back to Public Agents List</a>
    </div>

    <div class="discussion-thread">
        {% for message in messages|sort((a, b) => a.createdAt <=> b.createdAt) %}
            <div class="card mb-3 {% if message.role == 'user' %}border-primary{% else %}border-success{% endif %}">
                <div class="card-header">
                    <strong>{{ message.role|capitalize }}</strong> - {{ message.createdAt|date('Y-m-d H:i:s') }}
                </div>
                <div class="card-body">
                    {# Use nl2br to respect newlines, and raw for potential HTML content, ensure content is properly sanitized if needed #}
                    <p class="card-text">{{ message.content|nl2br|raw }}</p>
                </div>
            </div>
        {% else %}
            <div class="alert alert-info">No messages found in this discussion.</div>
        {% endfor %}
    </div>
{% endblock %}

{% block head_stylesheets %}
    {{ parent() }}
    <style>
        .discussion-thread .card-header {
            font-size: 0.9em;
            padding: 0.5rem 1rem;
        }
        .discussion-thread .card-body p {
            white-space: pre-wrap; /* Preserve whitespace and newlines */
        }
    </style>
{% endblock %} 