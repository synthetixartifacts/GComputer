### Run the Project (macOS + Windows)

Prereqs: Installed per `docs/howto/install.md`.

---

### Development

Start the dev environment (Vite + esbuild + Electron):
```bash
npm run dev
```

Renderer dev URL: http://localhost:5173/

Behavior:
- Vite dev server serves the Svelte renderer on port 5173.
- esbuild watches and rebuilds Electron main and preload to `dist/`.
- Electron launches and loads the dev server.

If port 5173 is busy, stop the other process or change `server.port` in `vite.config.mts`.
Aliases are defined in `vite.config.mts` and `tsconfig.json` (must match).

---

### Database (Drizzle + sql.js)

The SQLite database and migrations live in the workspace package `packages/db`. Uses sql.js (pure JavaScript SQLite) for cross-platform compatibility.

- DB file: `packages/db/data/gcomputer.db`
- Schema: `packages/db/src/db/schema.ts`
- Migrations: `packages/db/drizzle` (auto-generated by drizzle-kit)
- ORM init: `packages/db/src/db/client.ts`

Main process runs migrations on startup and exposes IPC handlers for CRUD on the test table.

During development:
- Changes to Electron main or preload require a fresh Electron restart to take effect.
  - Stop and restart the dev command: `Ctrl+C` then `npm run dev`.
  - After the window opens, you may need one hard reload (Cmd+R) of the window.
- Renderer hot-reloads automatically for Svelte/TS/SCSS changes.

Drizzle developer commands (run from repo root):
```bash
# Open Drizzle Studio UI
npm --workspace @gcomputer/db run drizzle:studio

# Re-generate migrations after editing schema.ts
npm --workspace @gcomputer/db run drizzle:generate
```

Manual DB test (optional):
```bash
npm --workspace @gcomputer/db run dev:test
```

Verify preload DB API in renderer DevTools:
```js
// In the console
window.gc // should include { settings, db }
await window.gc.db.test.list() // should return an array of rows
```

---

### Type checking
```bash
npm run typecheck
```

---

### Production build (local)

Build main/preload bundles and renderer assets:
```bash
npm run build
```

Artifacts:
- Electron main: `dist/main/index.cjs`
- Preload: `dist/preload/index.cjs`
- Renderer: `dist/renderer/`

To run Electron against the built assets (no dev server):
```bash
cross-env VITE_DEV_SERVER_URL= electron dist/main/index.cjs
```

---

### Clean Builds

To ensure fresh builds without cached artifacts:

**Available clean build commands:**
```bash
# Clean all build artifacts and caches
npm run clean

# Clean and rebuild (without packaging)
npm run clean:build

# Clean, rebuild, and package for Windows
npm run clean:build:win

# Clean, rebuild, and package for all platforms
npm run clean:build:all
```

**Manual clean build process:**
```bash
# Step 1: Remove all build artifacts
rm -rf dist/ release/ node_modules/.cache

# Step 2: Rebuild from scratch
npm run build

# Step 3: Package (optional)
npm run package:win  # or package:all for all platforms
```

**When to use clean builds:**
- After updating translation files
- When encountering stale code in packaged executables
- Before creating production releases
- When build artifacts seem corrupted

Note: Packaging into installers is covered in `release.md`.


